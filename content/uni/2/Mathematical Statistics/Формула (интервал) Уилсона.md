#uni
Рассмотрим выборку из $n$ независимых случайных величин:
$$
X_1, X_2, \dots, X_n \sim \text{Bernoulli}(\theta),
$$
где параметр $\theta \in (0,1)$ — неизвестная вероятность "успеха". Тогда выборочная доля успехов определяется как:
$$
\hat{\theta} = \overline{X} = \frac{1}{n} \sum_{i=1}^n X_i.
$$

Наша цель — построить доверительный интервал уровня $1 - \alpha$ для параметра $\theta$:
$$
P(T_1 < \theta < T_2) = 1 - \alpha,
$$
где $T_1$ и $T_2$ — функции от наблюдаемых данных.

---

## Шаг 1: Ввод новой случайной величины

Используем нормальное приближение для оценки $\hat{\theta}$, но не будем заменять параметр $\theta$ на $\hat{\theta}$ в знаменателе (как в методе Вальда). Вместо этого запишем точную форму нормализованной статистики (аналогичную $Z$-статистике):

$$
Z = \frac{\hat{\theta} - \theta}{\sqrt{ \frac{\theta(1 - \theta)}{n} }}.
$$

Центральная предельная теорема утверждает, что при достаточно большом $n$:
$$
Z \approx \mathcal{N}(0, 1).
$$

---

## Шаг 2: Используем определение доверительного интервала

По определению квантилей нормального распределения:
$$
P\left( -z_{\alpha/2} < Z < z_{\alpha/2} \right) \approx 1 - \alpha,
$$
что даёт:
$$
P\left( -z_{\alpha/2} < \frac{\hat{\theta} - \theta}{\sqrt{ \frac{\theta(1 - \theta)}{n} }} < z_{\alpha/2} \right) \approx 1 - \alpha.
$$

---

## Шаг 3: Преобразуем неравенство

Умножим на $\sqrt{\theta(1 - \theta)/n}$:
$$
P\left( \hat{\theta} - z_{\alpha/2} \sqrt{ \frac{\theta(1 - \theta)}{n} } < \theta < \hat{\theta} + z_{\alpha/2} \sqrt{ \frac{\theta(1 - \theta)}{n} } \right) \approx 1 - \alpha.
$$

Это выглядит как доверительный интервал, но с неизвестной величиной $\theta$ под корнем. В методе Вальда её просто заменяют на $\hat{\theta}$, но это грубое приближение. Метод Уилсона поступает иначе: он не приближает знаменатель, а решает это неравенство как квадратное относительно $\theta$.

---

## Шаг 4: Переписываем неравенство как квадратное

Рассмотрим неравенство:
$$
\left| \frac{\hat{\theta} - \theta}{\sqrt{ \frac{\theta(1 - \theta)}{n} }} \right| \le z_{\alpha/2}.
$$

Возведём обе части в квадрат:
$$
\frac{(\hat{\theta} - \theta)^2}{\frac{\theta(1 - \theta)}{n}} \le z_{\alpha/2}^2.
$$

Умножим обе части на $\frac{\theta(1 - \theta)}{n}$:
$$
(\hat{\theta} - \theta)^2 \le z_{\alpha/2}^2 \cdot \frac{\theta(1 - \theta)}{n}.
$$

Это неравенство можно привести к квадратному уравнению по $\theta$:
$$
n(\hat{\theta} - \theta)^2 - z^2 \theta(1 - \theta) \le 0,
$$
где $z = z_{\alpha/2}$

Теперь раскроем скобки и преобразуем:
$$
n(\hat{\theta}^2 - 2\hat{\theta}\theta + \theta^2) - z^2(\theta - \theta^2) \le 0,
$$

Приведём к единому виду:
$$
n\theta^2 - 2n\hat{\theta}\theta + n\hat{\theta}^2 - z^2\theta + z^2\theta^2 \le 0.
$$

Соберём всё по степеням $\theta$:
$$
(n + z^2)\theta^2 - (2n\hat{\theta} + z^2)\theta + n\hat{\theta}^2 \le 0.
$$

---

## Шаг 5: Решаем квадратное неравенство

Это квадратное неравенство:
$$
A\theta^2 + B\theta + C \le 0,
$$

где:
- $A = n + z^2$
- $B = - (2n\hat{\theta} + z^2)$
- $C = n\hat{\theta}^2$

Найдем корни по формуле:
$$
\theta = \frac{-B \pm \sqrt{B^2 - 4AC}}{2A}.
$$

Подставляя $A, B, C$, получаем **формулу Уилсона**:
$$
\left(
\frac{\hat{\theta} + \frac{z^2}{2n} - z \cdot \sqrt{ \frac{\hat{\theta}(1 - \hat{\theta})}{n} + \frac{z^2}{4n^2} }}{1 + \frac{z^2}{n}}, \quad
\frac{\hat{\theta} + \frac{z^2}{2n} + z \cdot \sqrt{ \frac{\hat{\theta}(1 - \hat{\theta})}{n} + \frac{z^2}{4n^2} }}{1 + \frac{z^2}{n}}
\right).
$$

---

## Вывод:

Метод Уилсона:
- не делает грубого приближения $\theta \approx \hat{\theta}$ в знаменателе;
- решает неравенство, полученное из нормальной аппроксимации, точно как квадратное по $\theta$;
- всегда даёт интервал в пределах $[0, 1]$ и лучше работает при малых $n$.

Интервал Уилсона — это строго выведенный результат из нормальной аппроксимации, но без приближения дисперсии параметра.
