---
tags:
  - uni
---
## 1. Canary Releases (Канареечные релизы)

### Идея
Название происходит от практики шахтёров брать канареек в шахты: если появлялся газ — птица погибала первой, предупреждая людей об опасности.  
Аналогично в IT: **мы сначала выкатываем новую версию только небольшой части пользователей**, чтобы быстро увидеть возможные проблемы.

### Как работает

- Деплоится новая версия рядом со старой.
- Маленький процент пользователей (например, 1-5%) направляется на новую версию.
- Сбор метрик (ошибки, отклики, скорость).
- Если всё хорошо — доля постепенно увеличивается до 100%.
- Если есть проблемы — быстро откатываемся.

### Преимущества
- Минимизация риска: проблема влияет на маленькую группу.
- Возможность сбора реальных пользовательских данных о новой версии.
- Плавный контроль выкладки.
### Недостатки
- Нужно уметь направлять трафик динамически (например, через умный роутер или сервис-меш).
- Более сложная инфраструктура.
- Нужно тщательно следить за метриками.


## 2. Blue-Green Deployment (Синяя-Зелёная выкладка)
### Идея
Мы всегда имеем **две среды**:
- "Синяя" (Blue) — текущая, рабочая версия.
- "Зелёная" (Green) — новая версия.

Когда зелёная готова и протестирована, трафик **переключается мгновенно** с синей на зелёную.

### Как работает
1. Разворачиваем новую версию в зелёной среде.
2. Тестируем её отдельно.
3. В один момент переключаем трафик со старой среды на новую.
4. При необходимости быстро возвращаем трафик обратно.

### Преимущества
- Быстрые переключения (почти без простоя).
- Лёгкий откат: просто перенаправляем трафик назад.
- Возможность тщательного тестирования новой версии до переключения.

### Недостатки

- Требуется **удвоенная инфраструктура**: обе версии должны работать параллельно.
- Если данные изменяются (например, база данных), может потребоваться особая стратегия миграции данных.
## 3. Rolling Update (Пошаговое обновление)

### Идея
Мы **обновляем приложение постепенно**, по частям — например, сервер за сервером.

### Как работает
- Есть пул серверов (реплик).
- Обновляем один сервер → проверяем → обновляем следующий.
- При проблемах можно остановить процесс или откатиться.

### Преимущества
- Не требует двойной инфраструктуры.
- Можно управлять скоростью обновления.

### Недостатки
- Более сложно откатываться, если обновление уже пошло на многие узлы.
- Время полной выкладки — дольше.

## 4. Feature Toggles (Фиче-флаги)

### Идея
Новая функциональность выкладывается в коде, но **скрыта за флагом**.  
Активируется она уже после выкладки, без новых деплоев.

### Как работает
- Функция пишется, но обёрнута проверкой флага.
- Выкатывается на продакшн вместе со старым кодом.
- Управляем включением флага: только для отдельных пользователей или групп.

### Преимущества
- Можно безопасно выкладывать код заранее.
- Можно быстро отключить новую функциональность, если что-то пошло не так.

### Недостатки
- Код усложняется из-за множества условий.
- Требует дисциплины в управлении флагами (чтобы вовремя их удалять).

## 5. Shadow Deployment (Теневая выкладка)

### Идея
Приложение работает с реальными запросами, но **ответы от новой версии не видят пользователи**.
### Как работает
- Входящие запросы **копируются**: основная версия обрабатывает их, а новая тестовая версия — тоже, но её результаты выбрасываются.
- Мы можем сравнивать поведение двух версий без риска.

### Преимущества
- Отличная проверка реальных нагрузок и ошибок **без воздействия на пользователей**.
- Возможность тестирования сложных изменений.

### Недостатки
- Нагрузка на инфраструктуру увеличивается.
- Нужно правильно реализовать копирование запросов.

## Выводы
Обычно на практике **комбинируют несколько подходов**. Например:
- Делают **канареечный релиз** с помощью **фиче-флагов**.
- Деплоят новую версию в **теневой режим**, чтобы собрать метрики.
- После успешного теста переходят к **пошаговому обновлению** или **переключению Blue-Green**.